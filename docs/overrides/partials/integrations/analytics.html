<!-- Determine analytics provider -->
{% if config.extra.analytics %}
  {% set provider = config.extra.analytics.provider %}
{% endif %}

<!-- Set up analytics provider -->
{% if provider %}
  {% include "partials/integrations/analytics/" ~ provider ~ ".html" %}

  <script>
    // Initialize Matomo's _paq array
    window._paq = window._paq || [];

    // Check initial consent and load analytics
    if (typeof __md_analytics !== "undefined") {
      var consent = __md_get("__consent");
      if (consent && consent.analytics) {
        window._paq.push(['rememberCookieConsentGiven']); // Remember consent
        __md_analytics(); // Load Matomo if consent is given
      }
      else {
        // If consent is revoked
        window._paq.push(['forgetCookieConsentGiven']); // Forget consent
        console.log("Analytics consent revoked. Cookies deleted.");
      }
    } 
  </script>
